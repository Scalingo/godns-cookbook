# Generated by Chef on <%= node['fqdn'] %>
#
# Toml config file

Title = "GODNS"
Version = "<%= node['godns']['version'] %>"
Author = "kenshin"

Debug = <%= node['godns']['debug'].to_s %>

[server]
host = "<%= node['godns']['host'] %>"
port = <%= node['godns']['port'] %>

[resolv]
resolv-file = "<%= node['godns']['resolv']['file'] %>"
timeout = <%= node['godns']['resolv']['timeout'] %> # seconds
setedns0 = <%= node['godns']['resolv']['setedns0'].to_s %>
interval = <%= node['godns']['resolv']['interval'] %>

<%- redis_uri = URI(node['godns']['redis']['url']) %>
<%- redis_db = redis_uri.path[1..-1] %>
[redis]
host = "<%= Resolv.getaddress(redis_uri.host) %>"
port = <%= redis_uri.port %>
db = <%= redis_db.nil? ? "0" : redis_db %>
password = "<%= redis_uri.password %>"

[log]
# If didn't set the log file,log will be redirected to console.
stdout = <%= node['godns']['log']['stdout'] %>
file = "<%= node['godns']['log']['file'] %>"
level = "<%= node['godns']['log']['level'] %>"

[cache]
# backend option [memory|redis]
# redis backend not implemented yet
backend = "<%= node['godns']['cache']['backend'] %>"
expire = <%= node['godns']['cache']['expire'] %> # seconds
maxcount = <%= node['godns']['cache']['maxcount'] %> # If set zero. The Sum of cache itmes will be unlimit.

[hosts]
# If set false, will not query hosts file and redis hosts record
enable = <%= node['godns']['hosts']['enable'].to_s %>
host-file = "<%= node['godns']['hosts']['file'] %>"
redis-enable = <%= node['godns']['hosts']['redis_enable'].to_s %>
redis-key = "<%= node['godns']['hosts']['redis_key'] %>"
ttl = <%= node['godns']['hosts']['ttl'] %>
refresh-interval = <%= node['godns']['hosts']['refresh_interval'].to_s %>
<% if node['godns']['hosts']['zone'] %>
zone = "<%= node['godns']['hosts']['zone'] %>"
zone-ns = "<%= node['godns']['hosts']['zone-ns'] %>"
zone-mbox = "<%= node['godns']['hosts']['zone-mbox'] %>"
zone-serial = <%= node['godns']['hosts']['zone-serial'] %>
zone-refresh = <%= node['godns']['hosts']['zone-refresh'] %>
zone-retry = <%= node['godns']['hosts']['zone-retry'] %>
zone-expire = <%= node['godns']['hosts']['zone-expire'] %>
zone-negcache-ttl = <%= node['godns']['hosts']['zone-negcache-ttl'] %>
zone-soa-ttl = <%= node['godns']['hosts']['zone-soa-ttl'] %>
<% end %>

[zones]
<% nodes['godns']['zones'].each_with_index do |zone, i| %>
  [zones.<%= i %>]
    name = "<%= zone['name'] %>"
    ns = "<%= zone['ns'] %>"
    mbox = "<%= zone['mbox'] %>"
    serial = <%= zone['serial'] %>
    refresh = <%= zone['refresh'] %>
    retry = <%= zone['retry'] %>
    expire = <%= zone['expire'] %>
    negcache-ttl = <%= zone['negcache-ttl'] %>
    soa-ttl = <%= zone['soa-ttl'] %>
